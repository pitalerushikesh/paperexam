<!doctype html>
<html>
  <head>
    <title>Excalidraw Embed</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@excalidraw/excalidraw/dist/excalidraw.production.min.js"></script>
    <style>
      body,
      html,
      #root {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        /* Disables all browser-level gestures like pinch-to-zoom */
        touch-action: none !important;
      }

      .excalidraw {
        background-color: #ffffff !important;
        background-image:
          linear-gradient(
            90deg,
            transparent 65px,
            #ffadad 65px,
            #ffadad 67px,
            transparent 67px
          ),
          linear-gradient(#d1e5f0 1px, transparent 1px) !important;
        background-size:
          100% 100%,
          100% 32px !important;
        background-position:
          0 0,
          0 40px !important;
        background-repeat: no-repeat, repeat !important;
      }

      /* Hide the zoom UI completely */
      .excalidraw .zoom-actions,
      .excalidraw .current-zoom,
      .excalidraw .footer-center {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script>
      window.process = { env: { NODE_ENV: "production" } };
      let apiReference = null;

      // 1. THE HARD LOCK: Intercept and kill wheel events before they bubble
      window.addEventListener(
        "wheel",
        (e) => {
          // Stop Ctrl+Wheel (Zoom) AND normal Wheel (if you want to prevent panning)
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            e.stopPropagation();
          }
        },
        { capture: true, passive: false },
      );

      // 2. THE GESTURE LOCK: Prevent pinch-to-zoom on trackpads
      window.addEventListener("gesturestart", (e) => e.preventDefault());
      window.addEventListener("gesturechange", (e) => e.preventDefault());

      function init() {
        const root = ReactDOM.createRoot(document.getElementById("root"));
        const Excalidraw = window.ExcalidrawLib.Excalidraw;

        const App = () => {
          return React.createElement(Excalidraw, {
            excalidrawRef: (api) => {
              apiReference = api;
            },
            onChange: (elements, state) => {
              // Safety check: force zoom to 1 if it ever slips through
              if (state.zoom.value !== 1 && apiReference) {
                apiReference.updateScene({ appState: { zoom: { value: 1 } } });
              }

              const payload = JSON.parse(JSON.stringify(elements));
              window.parent.postMessage(
                { type: "DRAWING_UPDATE", payload },
                "*",
              );
            },
            zenModeEnabled: true,
            gridModeEnabled: false,
            initialData: {
              appState: {
                activeTool: { type: "freedraw" },
                viewBackgroundColor: "transparent",
                zoom: { value: 1 },
                allowPanning: false,
              },
            },
          });
        };
        root.render(React.createElement(App));
      }

      const timer = setInterval(() => {
        if (window.ExcalidrawLib) {
          clearInterval(timer);
          init();
        }
      }, 100);
    </script>
  </body>
</html>
